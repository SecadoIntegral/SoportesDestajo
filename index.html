<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title></title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { margin-bottom: 10px; text-align: center; font-weight: bold; }
  table { border-collapse: collapse; margin-top: 10px; width: 100%; }
  th, td { border: 1px solid #000; padding: 6px; text-align: right; }
  th { background-color: #80c1ff; }
  td.left { text-align: left; }
  input[type="number"], input[type="text"] { text-align: center; }
  input[type="text"] { width: 300px; text-align: left; }
  #btnPrint { margin-top: 10px; padding: 6px 12px; cursor: pointer; }
  .btnRemove { padding: 2px 6px; cursor: pointer; }
  .totals { width: auto; margin: 0 auto; } /* tabla centrada */
  .totals td { border: 1px solid #000; text-align: center; }

  /* Ocultar elementos específicos al imprimir */
  @media print {
    #btnPrint, #titulo, .btnRemove, .accionCol { display: none; }
    th { -webkit-print-color-adjust: exact; print-color-adjust: exact; background-color: #80c1ff !important; }
  }
</style>
</head>
<body>

<h2 id="tituloPrint">Café Humedo Mojado ingresado a tolva</h2>
<input type="text" id="titulo" value="Café Humedo Mojado ingresado a tolva">

<!-- Tabla de totales centrada con bordes -->
<table class="totals">
  <tr>
    <td>Total qq - Recibidos</td>
    <td id="totalQQ">0</td>
  </tr>
  <tr>
    <td>Total Estibadores</td>
    <td><input type="number" id="totalEstibadores" value="11" min="1" style="width:60px;"></td>
  </tr>
  <tr>
    <td>Cada uno</td>
    <td id="cadaUno">0</td>
  </tr>
  <tr>
    <td>Precio</td>
    <td><input type="number" id="precio" value="2.50" step="0.01" min="0" style="width:60px;"></td>
  </tr>
  <tr>
    <td>Total cordobas</td>
    <td id="totalCordobas">0</td>
  </tr>
</table>

<!-- Tabla de datos -->
<table id="tablaDatos">
  <thead>
    <tr>
      <th>TK</th>
      <th>Sacos</th>
      <th>Kg</th>
      <th>QQs</th>
      <th>Maquina</th>
      <th class="accionCol">Acción</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button id="btnPrint" onclick="window.print()">Imprimir</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTYR281YP2n4MpZ2MpnOiE4pipDjYkCfjC_JSsNsdhjVot9yUrv25r1du-ctOQYI91_NOd6FiDtKpgC/pub?gid=774503374&single=true&output=csv";

let datosOriginales = [];
let datosFiltrados = [];

function cargarDatos() {
  return new Promise((resolve, reject) => {
    Papa.parse(csvUrl, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: results => resolve(results.data),
      error: err => reject(err)
    });
  });
}

function calcularTotales() {
  const totalQQ = datosFiltrados.reduce((sum, d) => sum + parseFloat(d["QQs"] || 0), 0);
  const estibadores = parseInt(document.getElementById("totalEstibadores").value) || 1;
  const precio = parseFloat(document.getElementById("precio").value) || 0;
  const cadaUno = totalQQ / estibadores;
  const totalCordobas = cadaUno * precio;

  document.getElementById("totalQQ").textContent = totalQQ.toFixed(2);
  document.getElementById("cadaUno").textContent = cadaUno.toFixed(2);
  document.getElementById("totalCordobas").textContent = totalCordobas.toFixed(2);
}

function llenarTabla() {
  const tbody = document.querySelector("#tablaDatos tbody");
  tbody.innerHTML = "";
  datosFiltrados.forEach((d, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="left">${d["Tk"]}</td>
      <td>${d["Sacos"]}</td>
      <td>${parseFloat(d["Peso Kg"] || 0).toFixed(2)}</td>
      <td>${parseFloat(d["QQs"] || 0).toFixed(2)}</td>
      <td class="left">${d["Maquina"]}</td>
      <td class="accionCol"><button class="btnRemove" onclick="quitarFila(${index})">Quitar</button></td>
    `;
    tbody.appendChild(row);
  });
  calcularTotales();
}

function quitarFila(index) {
  datosFiltrados.splice(index, 1);
  llenarTabla();
}

cargarDatos().then(datos => {
  datosOriginales = datos;
  datosFiltrados = [...datosOriginales];
  llenarTabla();

  const tituloInput = document.getElementById("titulo");
  const tituloPrint = document.getElementById("tituloPrint");
  tituloInput.addEventListener("input", () => {
    tituloPrint.textContent = tituloInput.value;
  });

  document.getElementById("totalEstibadores").addEventListener("input", calcularTotales);
  document.getElementById("precio").addEventListener("input", calcularTotales);

}).catch(err => console.error("Error al cargar CSV:", err));
</script>

</body>
</html>
